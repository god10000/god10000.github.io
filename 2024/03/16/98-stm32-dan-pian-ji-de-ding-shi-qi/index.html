<!DOCTYPE html>
<html lang="en" color-mode="light">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="å—åŒ—çš„çŒ«" />
  <!-- Open Graph Description ç®€çŸ­æ‘˜è¦-->
  
  <!-- ç”¨äºæœç´¢å¼•æ“çš„æ–‡ç« æ‘˜è¦ -->
  
  
  
  <title>
    
      STM32å•ç‰‡æœºçš„å®šæ—¶å™¨ 
      
      
      |
    
     å—åŒ—çš„çŒ«
  </title>

  
    <link rel="apple-touch-icon" href="/images/favicon.png">
    <link rel="icon" href="/images/favicon.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1886449_67xjft27j1l.css" />
  <!-- ä»£ç å—é£æ ¼ -->
  

  <!-- jquery3.3.1 -->
  
    <script defer type="text/javascript" src="/plugins/jquery.min.js"></script>
  

  <!-- fancybox -->
  
    <link href="/plugins/jquery.fancybox.min.css" rel="stylesheet">
    <script defer type="text/javascript" src="/plugins/jquery.fancybox.min.js"></script>
  
  
<script src="/js/fancybox.js"></script>


  

  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>
<meta name="generator" content="Hexo 6.1.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/">
      <!-- å¤´åƒå–æ¶ˆæ‡’åŠ è½½ï¼Œæ·»åŠ no-lazy -->
      
        <img src="/images/avatar.png" alt="">
      
    </a>
    <div class="nickname"><a href="/">Northcat</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">Home</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">Archives</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">Tags</a>
        </li>
      
        <li class="nav-item" data-path="/friends/">
          <a href="/friends/">Friends</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">About</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- æ–‡ç« è¯¦æƒ…é¡µï¼Œå±•ç¤ºæ–‡ç« å…·ä½“å†…å®¹ï¼Œurlå½¢å¼ï¼šhttps://yoursite/æ–‡ç« æ ‡é¢˜/ -->
<!-- åŒæ—¶ä¸ºã€Œæ ‡ç­¾tagã€ï¼Œã€Œæœ‹å‹friendã€ï¼Œã€Œåˆ†ç±»categoriesã€ï¼Œã€Œå…³äºaboutã€é¡µé¢çš„æ‰¿è½½é¡µé¢ï¼Œå…·ä½“å±•ç¤ºå–å†³äºpage.type -->


  <!-- LaTex Display -->

  
    <script async type="text/javascript" src="/plugins/mathjax/tex-chtml.js"></script>
  
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    }
  </script>





  <!-- clipboard -->

  
    <script async type="text/javascript" src="/plugins/clipboard.min.js"></script>
  
  
<script src="/js/codeCopy.js"></script>







  

  

  

  
  <!-- æ–‡ç« å†…å®¹é¡µ urlå½¢å¼ï¼šhttps://yoursite/æ–‡ç« æ ‡é¢˜/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">STM32å•ç‰‡æœºçš„å®šæ—¶å™¨</div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime mr-10" title="Update time"></i>
          2025-05-14 15:23:31
        </span>
        
      </div>
      <div class="markdown-body">
        <h2 id="åŸºæœ¬å®šæ—¶å™¨æ¡†å›¾"><a href="#åŸºæœ¬å®šæ—¶å™¨æ¡†å›¾" class="headerlink" title="åŸºæœ¬å®šæ—¶å™¨æ¡†å›¾"></a>åŸºæœ¬å®šæ—¶å™¨æ¡†å›¾</h2><p>å®šæ—¶å™¨çš„å¸¸ç”¨åŠŸèƒ½ä¸»è¦ä¸º<strong>å®šæ—¶ä¸­æ–­</strong>, <strong>PWMç”Ÿæˆ</strong></p>
<img src="/2024/03/16/98-stm32-dan-pian-ji-de-ding-shi-qi/image-20240316213946464.png" class="" title="image-20240316213946464">

<img src="/2024/03/16/98-stm32-dan-pian-ji-de-ding-shi-qi/image-20240316213942990.png" class="" title="image-20240316213942990">



<img src="/2024/03/16/98-stm32-dan-pian-ji-de-ding-shi-qi/image-20240316213952782.png" class="" title="image-20240316213952782">

<img src="/2024/03/16/98-stm32-dan-pian-ji-de-ding-shi-qi/image-20240316213956447.png" class="" title="image-20240316213956447">

<h2 id="STM32æ—¶é’Ÿæ ‘"><a href="#STM32æ—¶é’Ÿæ ‘" class="headerlink" title="STM32æ—¶é’Ÿæ ‘"></a>STM32æ—¶é’Ÿæ ‘</h2><p>SystemInit()å°±æ˜¯ç”¨æ¥é…ç½®æ—¶é’Ÿæ ‘çš„,å·¦è¾¹ä¸ºæ—¶é’Ÿäº§ç”Ÿç”µè·¯,å³è¾¹ä¸ºåˆ†é…ç”µè·¯, å†…éƒ¨å››ä¸ªæŒ¯è¡æº, å¯åŠ¨å†…éƒ¨æ—¶é’Ÿ, æš‚æ—¶ä»¥å†…éƒ¨8MHzä¸ºç³»ç»Ÿæ—¶é’Ÿ,å¯åŠ¨å¤–éƒ¨æ—¶é’Ÿ,PLLé”ç›¸ç¯9å€é¢‘åˆ°72MHz,é”ç›¸ç¯ç¨³å®šè¾“å‡ºååˆ‡æ¢ç³»ç»Ÿæ—¶é’Ÿä¸º72MHz</p>
<p>â—æ³¨æ„:</p>
<p>è‹¥å¤–éƒ¨æ™¶æŒ¯å‡ºç°é—®é¢˜, cssä¼šæŠŠæ—¶é’Ÿåˆ‡æ¢åˆ°å†…éƒ¨æ—¶é’Ÿ,æ­¤æ—¶ç³»ç»Ÿçš„æ—¶é’Ÿå°±æ…¢äº†ä¹å€</p>
<img src="/2024/03/16/98-stm32-dan-pian-ji-de-ding-shi-qi/image-20240317081714282.png" class="" title="image-20240317081714282">

<h2 id="å®šæ—¶ä¸­æ–­æ¨¡å¼"><a href="#å®šæ—¶ä¸­æ–­æ¨¡å¼" class="headerlink" title="å®šæ—¶ä¸­æ–­æ¨¡å¼"></a>å®šæ—¶ä¸­æ–­æ¨¡å¼</h2><img src="/2024/03/16/98-stm32-dan-pian-ji-de-ding-shi-qi/image-20240316214042758.png" class="" title="image-20240316214042758">

<p>è¿™ä¸¤ä¸ªå‡½æ•°çš„åŒºåˆ«</p>
<blockquote>
<ul>
<li><p><strong>TIM_TimeBaseInit</strong>æ˜¯æ ¹æ®ä½ è®¾å®šçš„å‚æ•°åˆå§‹åŒ–æ—¶åŸºå•å…ƒ</p>
</li>
<li><p><strong>TIM_TimeBaseStructInit</strong>æ˜¯å°†æ¯ä¸€ä¸ªå‚æ•°æŒ‰é»˜è®¤å‚æ•°åˆå§‹åŒ–</p>
<ul>
<li>(å³è®¾ç½®ä¸ºé¢„å®šä¹‰çš„é»˜è®¤å€¼ã€‚è¿™äº›é»˜è®¤å€¼æ˜¯æ ¹æ®STM32å¾®æ§åˆ¶å™¨åº“çš„è§„å®šé¢„è®¾çš„ï¼Œé€šå¸¸æ˜¯ä¸ºäº†ç¡®ä¿å®šæ—¶å™¨æ¨¡å—èƒ½ä»¥ä¸€ä¸ªåŸºæœ¬ä¸”ç¨³å®šçš„é…ç½®å¼€å§‹å·¥ä½œï¼Œå³ä½¿å¼€å‘è€…æ²¡æœ‰æ˜¾å¼è®¾ç½®æ‰€æœ‰çš„å‚æ•°)ã€‚</li>
</ul>
</li>
</ul>
</blockquote>
<img src="/2024/03/16/98-stm32-dan-pian-ji-de-ding-shi-qi/image-20240317075352159.png" class="" title="image-20240317075352159">

<h3 id="TIM1-RepetitionCounter"><a href="#TIM1-RepetitionCounter" class="headerlink" title="TIM1_RepetitionCounter"></a>TIM1_RepetitionCounter</h3><p><code>TIM1_RepetitionCounter</code>è®¾ç½®æ¶‰åŠåˆ°STM32å¾®æ§åˆ¶å™¨ä¸­é«˜çº§å®šæ—¶å™¨çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå³é‡å¤è®¡æ•°å™¨ï¼ˆRepetition Counterï¼Œç®€ç§°RCRï¼‰ã€‚</p>
<p>è¿™ä¸ªè®¡æ•°å™¨çš„ä½œç”¨æ˜¯<strong>å®šä¹‰åœ¨å®šæ—¶å™¨äº§ç”Ÿä¸€ä¸ªæ›´æ–°äº‹ä»¶ï¼ˆé€šå¸¸æ˜¯è®¡æ—¶å‘¨æœŸç»“æŸå¹¶é‡æ–°å¼€å§‹çš„æ ‡å¿—ï¼‰ä¹‹å‰, è®¡æ•°å™¨éœ€è¦å®Œæˆçš„è®¡æ•°å‘¨æœŸæ•°</strong>ã€‚æ¢å¥è¯è¯´ï¼Œ<em>RCRå†³å®šäº†å®šæ—¶å™¨éœ€è¦è®¡æ•°å¤šå°‘æ¬¡æ‰è§¦å‘ä¸€æ¬¡æ›´æ–°äº‹ä»¶</em>ã€‚</p>
<h3 id="RCRçš„å·¥ä½œåŸç†"><a href="#RCRçš„å·¥ä½œåŸç†" class="headerlink" title="RCRçš„å·¥ä½œåŸç†"></a>RCRçš„å·¥ä½œåŸç†</h3><blockquote>
<p>å½“RCRè®¾ç½®ä¸ºæŸä¸ªå€¼Næ—¶ï¼Œå®šæ—¶å™¨çš„å‘ä¸‹è®¡æ•°å™¨ä¼šä»Nå¼€å§‹è®¡æ•°ï¼Œæ¯æ¬¡åˆ°0æ—¶ï¼Œäº§ç”Ÿä¸€ä¸ªæ›´æ–°äº‹ä»¶ï¼Œå¹¶ä¸”è®¡æ•°å™¨é‡æ–°ä»Nå¼€å§‹è®¡æ•°ã€‚è¿™æ ·ï¼Œæ›´æ–°äº‹ä»¶çš„äº§ç”Ÿä¸å†æ˜¯æ¯ä¸ªè®¡æ•°å‘¨æœŸç»“æŸæ—¶å‘ç”Ÿï¼Œè€Œæ˜¯æ¯N+1ä¸ªå‘¨æœŸå‘ç”Ÿä¸€æ¬¡ã€‚</p>
</blockquote>
<p>è®¾ç½®ä¸º0æ—¶ï¼Œè¡¨ç¤ºæ¯ä¸ªå‘¨æœŸç»“æŸéƒ½ä¼šäº§ç”Ÿæ›´æ–°äº‹ä»¶ï¼Œå³æ²¡æœ‰é‡å¤è®¡æ•°çš„å»¶è¿Ÿã€‚</p>
<h3 id="TIM-ClearFlag"><a href="#TIM-ClearFlag" class="headerlink" title="TIM_ ClearFlag"></a>TIM_ ClearFlag</h3><img src="/2024/03/16/98-stm32-dan-pian-ji-de-ding-shi-qi/image-20240317080908937.png" class="" title="image-20240317080908937">

<p>æ”¾åœ¨è¿™é‡Œæ¸…é™¤</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">TIM_ClearFlag(TIM2, TIM_FLAG_Update);                           
TIM_ITConfig(TIM2,TIM_IT_Update,ENABLE);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>å› ä¸º<strong>TIM_TimeBaseInit()åˆå§‹åŒ–å‡½æ•°</strong>çš„æœ«å°¾æ‰‹åŠ¨ç”Ÿæˆäº†ä¸€ä¸ªæ›´æ–°äº‹ä»¶,é‡æ–°è£…åœ¨é¢„åˆ†é¢‘å™¨å’Œé‡å¤è®¡æ•°å™¨çš„å€¼</p>
<blockquote>
<p>é¢„åˆ†é¢‘å™¨æœ‰ç¼“å†²å¯„å­˜å™¨,å†™å…¥çš„å€¼åªæœ‰åœ¨æ›´æ–°äº‹ä»¶æ—¶, æ‰ä¼šçœŸæ­£èµ·ä½œç”¨,</p>
<p>è¿™å¥ä»£ç æ‰‹åŠ¨ç”Ÿæˆäº†ä¸€ä¸ªæ›´æ–°äº‹ä»¶, è®©é¢„åˆ†é¢‘å™¨çš„å€¼ç«‹åˆ»ç”Ÿæ•ˆ</p>
</blockquote>
<p>äº§ç”Ÿçš„é—®é¢˜:</p>
<ul>
<li>æ›´æ–°äº‹ä»¶ä¸æ›´æ–°ä¸­æ–­å‡ ä¹åŒæ—¶å‘ç”Ÿ, <strong>æ›´æ–°ä¸­æ–­ä¼šç½®ä¸­æ–­æ ‡å¿—ä½, åˆå§‹åŒ–ç»“æŸåå°±ä¼šç«‹åˆ»è¿›å…¥ä¸­æ–­</strong>, æ‰€ä»¥åœ¨åˆå§‹åŒ–ä¹‹å, <strong>æ‰‹åŠ¨æ¸…é™¤ä¸­æ–­æ ‡å¿—ä½</strong>å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜</li>
</ul>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">&#x2F;* Generate an update event to reload the Prescaler and the Repetition counter
   values immediately *&#x2F;
TIMx-&gt;EGR &#x3D; TIM_PSCReloadMode_Immediate;   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="ARRä¸PSC"><a href="#ARRä¸PSC" class="headerlink" title="ARRä¸PSC"></a>ARRä¸PSC</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c">TIM_TimeBaseInitStructure.TIM_Period &#x3D; 10000-1;                &#x2F;&#x2F;è‡ªåŠ¨é‡è£…è½½å€¼ ARR
TIM_TimeBaseInitStructure.TIM_Prescaler &#x3D; 7200-1;              &#x2F;&#x2F;é¢„åˆ†é¢‘ç³»æ•° PSC<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>ARRâ†‘, PSCâ†“,ä»¥æ›´å¿«çš„é€Ÿåº¦è®¡æ›´å¤šçš„æ•°</p>
<p>ä¹Ÿå°±æ˜¯è¯´ARRè¶Šå¤§, è®¡æ•°ä¸Šé™è¶Šå¤§, åŒæ—¶é¢‘ç‡è¶Šé«˜;PSCè¶Šå°, é¢‘ç‡è¶Šé«˜</p>
<blockquote>
<p>72MHz&#x2F;720&#x3D;0.1MHz  1&#x2F;0.1MHz&#x3D;10us 10us*10000&#x3D;0.1sè®¡æ•°ä¸€æ¬¡</p>
<p>1&#x2F;((72MHz&#x2F;7200)*10000)&#x3D;1s</p>
</blockquote>
<h2 id="å¤–éƒ¨ä¸­æ–­æ¨¡å¼"><a href="#å¤–éƒ¨ä¸­æ–­æ¨¡å¼" class="headerlink" title="å¤–éƒ¨ä¸­æ–­æ¨¡å¼"></a>å¤–éƒ¨ä¸­æ–­æ¨¡å¼</h2><p>å¤–éƒ¨è§¦å‘å®šæ—¶å™¨è®¡æ•°, ä¸å¤–éƒ¨ä¸­æ–­ç›¸ä¼¼</p>
<h2 id="è¾“å‡ºæ¯”è¾ƒæ¨¡å¼"><a href="#è¾“å‡ºæ¯”è¾ƒæ¨¡å¼" class="headerlink" title="è¾“å‡ºæ¯”è¾ƒæ¨¡å¼"></a>è¾“å‡ºæ¯”è¾ƒæ¨¡å¼</h2><p>ä¹Ÿå°±æ˜¯PWMæ¨¡å¼</p>
<p>PWMè„‰å†²å®½åº¦è°ƒåˆ¶, å®é™…ä¸Šæ˜¯é€šè¿‡å¼€ã€å…³ã€å¼€ã€å…³å®ç°ç­‰æ•ˆæ¨¡æ‹Ÿé‡(åªå¯¹æœ‰æƒ¯æ€§ä½œç”¨çš„èµ·ä½œç”¨,æ¯”å¦‚ç”µæœºã€LEDç­‰)</p>
<img src="/2024/03/16/98-stm32-dan-pian-ji-de-ding-shi-qi/image-20240319113441437.png" class="" title="image-20240319113441437">

<img src="/2024/03/16/98-stm32-dan-pian-ji-de-ding-shi-qi/image-20240319113626758.png" class="" title="image-20240319113626758">

<p>ä¸‹å›¾, å¦‚æœæ²¡æœ‰ccr, å°±æ˜¯æ­£å¸¸çš„è®¡æ•°å€¼åˆ°è‡ªåŠ¨é‡è£…è½½å€¼æ¸…é›¶ä¸ºä¸€ä¸ªå‘¨æœŸ</p>
<img src="/2024/03/16/98-stm32-dan-pian-ji-de-ding-shi-qi/image-20240318114913262.png" class="" title="image-20240318114913262">

<p>å…¬å¼å¦‚ä¸‹:</p>
<p>æ¯”å¦‚: </p>
<ul>
<li><p>è¦é¢‘ç‡ä¸º10k, é‚£ä¹ˆ72M&#x2F;(psc+1)&#x2F;100&#x3D;10k, åˆ™psc+1&#x3D;72</p>
</li>
<li><p>å ç©ºæ¯”ä¸º50%, ccr&#x3D;50</p>
</li>
<li><p>åˆ†è¾¨ç‡ä¸º1%, é‚£ä¹ˆä»åå¾€å‰æ¨arr+1&#x3D;100</p>
</li>
</ul>
<p>å…³äºä¸ºä»€éƒ½æ˜¯+1</p>
<p>å› ä¸ºè®¡æ•°å™¨æº¢å‡ºä¸æ˜¯65535æº¢å‡ºè€Œæ˜¯ç¬¬65536æ—¶æº¢å‡º, æ‰€ä»¥å®é™…ä¸Šè®¡æ•°å€¼è¦å¤š1</p>
<img src="/2024/03/16/98-stm32-dan-pian-ji-de-ding-shi-qi/image-20240319113356763.png" class="" title="image-20240319113356763">

<h3 id="å‘¼å¸ç¯"><a href="#å‘¼å¸ç¯" class="headerlink" title="å‘¼å¸ç¯"></a>å‘¼å¸ç¯</h3><p>åŸç†: é€šè¿‡è°ƒèŠ‚å ç©ºæ¯”, æ”¹å˜LEDäº®ç­æ—¶é•¿, äººçœ¼çœ‹ä¸Šå»å°±æ˜¯å‘¼å¸ç¯çš„æ•ˆæœ</p>
<p>å‡ºç°BUG, ä¸çŸ¥é“ä¸ºå•¥, å°±æ˜¯æ±Ÿåç§‘æŠ€çš„ä»£ç çƒ§è¿›å»æ­£å¸¸ä½¿ç”¨, å¤åˆ¶åˆ°æ–°çš„å·¥ç¨‹å°±ä¸å¥½ä½¿äº†</p>
<p>è§£å†³: </p>
<p>åŠ ä¸Šå°±æ²¡ååº”äº†,å…¶å®è¿™é‡Œåº”è¯¥æ–­ç‚¹è°ƒè¯•,ä½†æ˜¯æˆ‘é€‰æ‹©äº†ä¸€ä¸ªä¸€ä¸ªå¯¹,åæ¥å‘ç°å°±å‰©delayä¸ä¸€æ ·äº†,æ¢äº†ä¹‹åä¹Ÿå¥½äº†</p>
<p>è¿˜ä»¥ä¸ºæ˜¯delayå‡ºäº†é—®é¢˜,ç»“æœæ˜¯<strong>æˆ‘æ²¡åˆå§‹åŒ–delay</strong>, æ‰€ä»¥ç¨‹åºåº”è¯¥æ˜¯å¡ä½äº†</p>
<p>å¦å¤–,é¢‘ç‡ä¸èƒ½å¤ªä½å¦åˆ™ä¼šä¸€ç›´é—ªçƒ</p>
<h3 id="èˆµæœºæ§åˆ¶"><a href="#èˆµæœºæ§åˆ¶" class="headerlink" title="èˆµæœºæ§åˆ¶"></a>èˆµæœºæ§åˆ¶</h3><img src="/2024/03/16/98-stm32-dan-pian-ji-de-ding-shi-qi/image-20240319113514350.png" class="" title="image-20240319113514350">

<p><strong>è§’åº¦å ç©ºæ¯”æ¢ç®—</strong></p>
<p>æ‰€ä»¥**(angle&#x2F;180<em>2+0.5)&#x2F;20*100</em>*, </p>
<blockquote>
<ul>
<li>è§’åº¦æ˜ å°„æˆè„‰å†²å®½åº¦ angle&#x2F;180*(2.5-0.5)</li>
<li>è„‰å†²å®½åº¦&#x2F;20(å‘¨æœŸ)&#x3D;å ç©ºæ¯”</li>
<li>å› ä¸ºccr&#x2F;arr&#x3D;å ç©ºæ¯”,æ•…æ¢ç®—å‡ºæ­¤æ—¶çš„ccr</li>
</ul>
</blockquote>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">âŒTIM_SetCompare2(TIM2,((angle&#x2F;180)*2+0.5)&#x2F;20*100);
  æ²¡é”™,è¿™ä¹ˆç®—æ˜¯æ­£ç¡®çš„,å…¬å¼å¤æ‚äº†ä¸€äº›
   CCR &#x3D; (æœ€å°è„‰å®½ + (angle&#x2F;180) * è„‰å®½èŒƒå›´) &#x2F; å®šæ—¶å™¨å‘¨æœŸ * ARR<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>pulse&#x3D;(180&#x2F;180)*(2.5-0.5)+0.5è§’åº¦æ¢ç®—è„‰å†²å®½åº¦</p>
<p>pulse&#x2F;20(å‘¨æœŸ)&#x3D;å ç©ºæ¯”&#x3D;0.125&#x3D;12.5%&#x2F;100(ARR)&#x3D;CCR</p>
</blockquote>
<p>ç®€å•æƒ³,å°±æ˜¯æŠŠ0<del>180å¯¹åº”åˆ°2.5</del>12.5</p>
<p>æ ¹æ®å ç©ºæ¯”ä¸º2.5%~12.5%</p>
<p>æ ¹æ®<strong>0.5&#x2F;20</strong><del><strong>2.5&#x2F;20</strong>&#x3D;<strong>2.5&#x2F;100</strong></del><strong>12.5&#x2F;100</strong>çš„å¯¹åº”å…³ç³»,å…¶å®å°±æ˜¯<strong>å ç©ºæ¯”</strong></p>
<p>âœ”ï¸å…¶å®å°±æ˜¯0.5~2.5ms&#x2F;20ms&#x3D;å ç©ºæ¯”(2.5%12.5%)  ARR&#x3D;100,é‚£ä¹ˆå¯¹åº”å ç©ºæ¯”çš„CCRä¸º2.5-12.5</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">TIM_SetCompare2(TIM2,angle&#x2F;180*10+2.5);           
&#x2F;&#x2F;è¿™ä¸ªä¹Ÿæ²¡é”™,ä¹‹å‰å¤±æ•ˆçš„åŸå› æ˜¯æ›´æ”¹ARRåæ²¡æœ‰æ›´æ”¹PSC,å¯¼è‡´å‘¨æœŸå‘ç”Ÿå˜åŒ–<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>å•ä½HZå¯¹åº”s,å³20msçš„é¢‘ç‡ä¸º1&#x2F;0.02&#x3D;50hz,å³èˆµæœºé¢‘ç‡ä¸º50HZ</p>
<p>é‚£ä¹ˆ<strong>Freq&#x3D;CK_PSC&#x2F;(PSC+1)&#x2F;(ARR+1)&#x3D;50HZ,</strong></p>
<p>æ‰¾ä¸€ä¸ªæ¯”è¾ƒå¥½è®¡ç®—çš„å€¼,å¯ä»¥è®¾ç½®PSCä¸º72,ARRä¸º20000, 20kå¯¹åº”20ms,CCR&#x3D;500å¯¹åº”0.5ms</p>
<h3 id="é©±åŠ¨ç”µæœº"><a href="#é©±åŠ¨ç”µæœº" class="headerlink" title="é©±åŠ¨ç”µæœº"></a>é©±åŠ¨ç”µæœº</h3><p>ç”µæœºçš„é¢‘ç‡ä¸€èˆ¬å¼<strong>5K~20KHZ</strong>,æ ¹æ®å…¬å¼72&#x2F;(psc+1)&#x2F;(arr+1)&#x3D;20K</p>
<p>å¯ä»¤(psc+1)&#x3D;0, (arr+1)&#x3D;3600</p>
<h3 id="éPIDæ§åˆ¶ç”µæœºä½ç½®"><a href="#éPIDæ§åˆ¶ç”µæœºä½ç½®" class="headerlink" title="éPIDæ§åˆ¶ç”µæœºä½ç½®"></a>éPIDæ§åˆ¶ç”µæœºä½ç½®</h3><p>ä»¥å‰å†™çš„,å¿˜äº†å’‹ç®—,éš¾é“æ˜¯è¯•å‡ºæ¥çš„</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">Load(-800,1000);  &#x2F;&#x2F;0.73sä¸€åœˆå·¦å³                               
delay_ms(762);    &#x2F;&#x2F;ä½†æ˜¯æ²¡æœ‰è¾¾åˆ°,å–ä¸‰æ¬¡è„‰å†²å¹³å‡å€¼è®¡ç®—,æœ‰è¯¯å·®,ä½†æ˜¯è¯¯å·®å˜å°äº†
t2&#x3D;Read_Speed(2);
t4&#x3D;Read_Speed(4);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>72m&#x2F;7200&#x3D;10k,1560&#x2F;10k&#x2F;2&#x3D;760</p>
<p>æˆ‘å½“æ—¶å¾ˆæœ‰å¯èƒ½æ˜¯é€šè¿‡<strong>å®é™…æµ‹è¯•å›ºå®šå ç©ºæ¯”çš„è„‰å†²æ•°</strong>,ç„¶å<strong>1560é™¤ä»¥è„‰å†²æ•°</strong>å°±å¾—åˆ°äº†<strong>å›ºå®šå ç©ºæ¯”è½¬ä¸€åœˆ</strong>çš„æ—¶é—´</p>
<h2 id="è¾“å…¥æ•è·æ¨¡å¼"><a href="#è¾“å…¥æ•è·æ¨¡å¼" class="headerlink" title="è¾“å…¥æ•è·æ¨¡å¼"></a>è¾“å…¥æ•è·æ¨¡å¼</h2><p>ICï¼ˆInput Captureï¼‰è¾“å…¥æ•è·</p>
<blockquote>
<p>è¾“å…¥æ•è·æ¨¡å¼ä¸‹ï¼Œå½“é€šé“è¾“å…¥å¼•è„šå‡ºç°æŒ‡å®šç”µå¹³è·³å˜æ—¶ï¼Œå½“å‰CNTçš„å€¼å°†è¢«é”å­˜åˆ°CCRä¸­ï¼Œå¯ç”¨äºæµ‹é‡PWMæ³¢å½¢çš„é¢‘ç‡ã€å ç©ºæ¯”ã€è„‰å†²é—´éš”ã€ç”µå¹³æŒç»­æ—¶é—´ç­‰å‚æ•°æ¯ä¸ªé«˜çº§å®šæ—¶å™¨å’Œé€šç”¨å®šæ—¶å™¨éƒ½æ‹¥æœ‰4ä¸ªè¾“å…¥æ•è·é€šé“</p>
<p>å¯é…ç½®ä¸ºPWMIæ¨¡å¼ï¼ŒåŒæ—¶æµ‹é‡é¢‘ç‡å’Œå ç©ºæ¯”å¯é…åˆä¸»ä»è§¦å‘æ¨¡å¼ï¼Œå®ç°ç¡¬ä»¶å…¨è‡ªåŠ¨æµ‹é‡</p>
</blockquote>
<p>ps: ç”µæœºæŒ¯åŠ¨å¯ä»¥å‘å£°</p>
<p><strong>æµ‹é¢‘æ–¹æ³•</strong></p>
<img src="/2024/03/16/98-stm32-dan-pian-ji-de-ding-shi-qi/image-20240319113335201.png" class="" title="image-20240319113335201">

<p>æ ‡å‡†é¢‘ç‡Fcå°±æ˜¯æ—¶é’Ÿ&#x2F;é¢„åˆ†é¢‘ç³»æ•°,å°±æ˜¯å®šæ—¶å™¨è‡ªå¢çš„é¢‘ç‡</p>
<img src="/2024/03/16/98-stm32-dan-pian-ji-de-ding-shi-qi/image-20240319113712211.png" class="" title="image-20240319113712211">

<p><strong>ä¸»ä»è§¦å‘æ¨¡å¼</strong></p>
<img src="/2024/03/16/98-stm32-dan-pian-ji-de-ding-shi-qi/image-20240319113804333.png" class="" title="image-20240319113804333">

<p>ğŸ”ºé‡ç‚¹</p>
<img src="/2024/03/16/98-stm32-dan-pian-ji-de-ding-shi-qi/image-20240319113836650.png" class="" title="image-20240319113836650">

<img src="/2024/03/16/98-stm32-dan-pian-ji-de-ding-shi-qi/image-20240319113852705.png" class="" title="image-20240319113852705">



<h3 id="æ˜“é”™"><a href="#æ˜“é”™" class="headerlink" title="æ˜“é”™"></a>æ˜“é”™</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c">void IC_Init(void)
&#123;
  &#x2F;&#x2F; åˆå§‹åŒ–RCCæ—¶é’Ÿé…ç½®
  &#x2F;&#x2F;å®šæ—¶å™¨æ—¶é’Ÿå¼€å¯
    
  &#x2F;&#x2F;è¾“å…¥æ¯”è¾ƒå¼•è„šåˆå§‹åŒ–
  &#x2F;&#x2F;æ—¶åŸºå•å…ƒåˆå§‹åŒ–
    
  &#x2F;&#x2F;ä¸‹é¢æ˜¯è¾“å…¥æ•è·åˆå§‹åŒ–
  TIM_ICInitTypeDef TIM_ICInitStructure;
  TIM_ICInitStructure.TIM_Channel &#x3D; TIM_Channel_1;
  TIM_ICInitStructure.TIM_ICFilter &#x3D; 0xF;                       &#x2F;&#x2F;è¾“å…¥æ•è·æ»¤æ³¢å™¨é…ç½®
  TIM_ICInitStructure.TIM_ICPolarity &#x3D; TIM_ICPolarity_Rising; &#x2F;&#x2F; æ•è·ä¿¡å·çš„ææ€§è®¾ç½®ï¼Œè¿™é‡Œè®¾ç½®ä¸ºä¸Šå‡æ²¿è§¦å‘æ•è·
  TIM_ICInitStructure.TIM_ICPrescaler &#x3D; TIM_ICPSC_DIV1;         &#x2F;&#x2F;è¾“å…¥æ•è·åˆ†é¢‘ç³»æ•°,è¿™é‡Œé€‰æ‹©
  TIM_ICInitStructure.TIM_ICSelection &#x3D; TIM_ICSelection_DirectTI;
  TIM_PWMIConfig(TIM3,&amp;TIM_ICInitStructure);                    &#x2F;&#x2F;PWMIäº¤å‰æ¨¡å¼, ç›¸å½“äºä¸‹é¢é…ç½®,åªæœ‰é€šé“1ã€2èƒ½ç”¨ 

	&#x2F;&#x2F; æ‰‹åŠ¨é…ç½®é€šé“2é—´æ¥æ•è·æ¨¡å¼
    &#x2F;&#x2F;  TIM_ICInitStructure.TIM_Channel &#x3D; TIM_Channel_2;
	&#x2F;&#x2F;  TIM_ICInitStructure.TIM_ICFilter &#x3D; 0xF;
	&#x2F;&#x2F;  TIM_ICInitStructure.TIM_ICPolarity &#x3D; TIM_ICPolarity_Falling;
	&#x2F;&#x2F;  TIM_ICInitStructure.TIM_ICPrescaler &#x3D; TIM_ICPSC_DIV1;        
	&#x2F;&#x2F;  TIM_ICInitStructure.TIM_ICSelection &#x3D; TIM_ICSelection_IndirectTI;
    
  &#x2F;&#x2F; åˆå§‹åŒ–å®šæ—¶å™¨3çš„è¾“å…¥æ•è·åŠŸèƒ½
  TIM_ICInit(TIM3, &amp;TIM_ICInitStructure);                       
  &#x2F;&#x2F; é€‰æ‹©å®šæ—¶å™¨3çš„è¾“å…¥è§¦å‘æºï¼Œè¿™é‡Œé€‰æ‹©çš„æ˜¯TI1FP1ï¼ˆé€šé“1çš„æ»¤æ³¢åä¸Šå‡æ²¿è§¦å‘ï¼‰
  TIM_SelectInputTrigger(TIM3,TIM_TS_TI1FP1);                   &#x2F;&#x2F;é€‰æ‹©è¾“å…¥è§¦å‘æº
  &#x2F;&#x2F; è®¾ç½®å®šæ—¶å™¨3çš„ä»æ¨¡å¼ä¸ºé‡ç½®æ¨¡å¼ï¼Œä½¿å®šæ—¶å™¨å¯ä»¥åœ¨è§¦å‘è¾“å…¥æ—¶è‡ªåŠ¨é‡ç½®è®¡æ•°å™¨,æ¸…é›¶
  TIM_SelectSlaveMode(TIM3,TIM_SlaveMode_Reset);               
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>DirectTI</strong></p>
<p> è¡¨ç¤º <strong>Direct Input Capture</strong>,ç›´æ¥è¾“å…¥æ•è·. å½“è®¾ç½®ä¸º <code>TIM_ICSelection_DirectTI</code> æ—¶ï¼Œæ„å‘³ç€è¾“å…¥æ•è·é€šé“ï¼ˆå¦‚ IC1, IC2, IC3, IC4ï¼‰ç›´æ¥è¿æ¥åˆ°ç›¸åº”çš„å¤–éƒ¨å¼•è„šï¼ˆå³ TI1, TI2, TI3, TI4ï¼‰ä¸Š</p>
<p><strong>TIM_ICSelection_IndirectTI</strong>ç½®ä¸ºé—´æ¥æ•è·æ¨¡å¼ï¼ŒIC2å°†ä»IC1çš„ä¿¡å·æ•è·ï¼Œå³ä½¿ç‰©ç†ä¸Šè¿æ¥åˆ°TI2</p>
<p>å³å®ç°äº†<strong>é€šé“ä¸€æ•è·é¢‘ç‡,é€šé“2æ•è·å ç©ºæ¯”</strong>,IC2é€‰æ‹©ä¸‹é™æ²¿,æ˜¯å› ä¸ºå ç©ºæ¯”&#x3D;é«˜ç”µå¹³è„‰å†²å®½åº¦&#x2F;å‘¨æœŸ</p>
<p><strong>é¢‘ç‡è·å–å‡½æ•°</strong></p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">uint32_t IC_GetFreq(void)
&#123;
 	&#x2F;&#x2F;æ•è·çš„æ˜¯CNTè®¡æ•°å€¼,Freq&#x3D;1M&#x2F;N
	return 1000000 &#x2F; (TIM_GetCapture1(TIM3) + 1); &#x2F;&#x2F;å› ä¸ºè®¡æ•°å™¨ä»0å¼€å§‹è®¡æ•°,æ‰€ä»¥å®é™…è®¡æ•°å€¼&#x3D;N+1
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>å ç©ºæ¯”è®¡ç®—å‡½æ•°</strong></p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">uint32_t IC_GetDuty(void)
&#123;
    &#x2F;&#x2F;å ç©ºæ¯”çš„ç»“æœæ˜¯0~1çš„æ•°,æ‰€ä»¥*100å˜æˆæ•´æ•°
	return (TIM_GetCapture2(TIM3)+1)*100&#x2F; (TIM_GetCapture1(TIM3)+1);
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æ•´å‹é™¤æ³•ä¼šå¯¼è‡´å°æ•°éƒ¨åˆ†ä¸¢å¤±ï¼Œå¯¼è‡´ç»“æœæ€»æ˜¯0ã€‚å½“0ä¹˜ä»¥100åï¼Œç»“æœä»ç„¶æ˜¯0,<strong>æ‰€ä»¥*100è¦æ”¾åœ¨å‰é¢</strong></p>
<p>ğŸ”ºæ³¨æ„<strong>ç±»å‹è½¬æ¢</strong>çš„é—®é¢˜,æˆ–è€…å¯ä»¥ä½¿ç”¨(float)å¼ºåˆ¶ç±»å‹è½¬æ¢,å‡½æ•°ç±»å‹ä¹Ÿæ¢æˆfloat,ä¹Ÿå¯ä»¥</p>
<h2 id="ç¼–ç å™¨æ¨¡å¼"><a href="#ç¼–ç å™¨æ¨¡å¼" class="headerlink" title="ç¼–ç å™¨æ¨¡å¼"></a>ç¼–ç å™¨æ¨¡å¼</h2><img src="/2024/03/16/98-stm32-dan-pian-ji-de-ding-shi-qi/image-20240322140930096.png" class="" title="image-20240322140930096">

<img src="/2024/03/16/98-stm32-dan-pian-ji-de-ding-shi-qi/image-20240322145039480.png" class="" title="image-20240322145039480">

<img src="/2024/03/16/98-stm32-dan-pian-ji-de-ding-shi-qi/image-20240322145045852.png" class="" title="image-20240322145045852">

<h3 id="ç¼–ç å™¨æµ‹é€Ÿ"><a href="#ç¼–ç å™¨æµ‹é€Ÿ" class="headerlink" title="ç¼–ç å™¨æµ‹é€Ÿ"></a>ç¼–ç å™¨æµ‹é€Ÿ</h3><p><strong>Mæ³•æµ‹é€Ÿ</strong><br>åˆå«åšé¢‘ç‡æµ‹é‡æ³•,ç»Ÿè®¡å›ºå®šæ—¶é—´å†…çš„ç¼–ç å™¨è„‰å†²æ•°,Mæ³•é€‚åˆæµ‹é‡é«˜é€Ÿã€‚</p>
<p>å‡è®¾ï¼š</p>
<p>ç¼–ç å™¨å•åœˆæ€»è„‰å†²æ•°ä¸ºCï¼ˆå¸¸æ•°ï¼‰</p>
<p>ç»Ÿè®¡æ—¶é—´ä¸ºT0</p>
<p> è¯¥æ—¶é—´å†…ç»Ÿè®¡åˆ°çš„ç¼–ç å™¨è„‰å†²æ•°ä¸ºM 0 </p>
<p>åˆ™ï¼šè½¬é€Ÿnï¼ˆåœˆ&#x2F;ç§’ï¼‰çš„è®¡ç®—å…¬å¼ä¸ºï¼š</p>
<img src="/2024/03/16/98-stm32-dan-pian-ji-de-ding-shi-qi/image-20240323075808389.png" class="" title="image-20240323075808389">

<p><strong>ä¾‹:</strong></p>
<p>å‡å¦‚ç¼–ç å™¨çº¿æ•°ä¸º11,å‡é€Ÿæ¯”ä¸º30</p>
<p>åˆ™ç”µæœºè½¬åŠ¨ä¸€åœˆçš„è„‰å†²æ•°ä¸º11*30&#x3D;330</p>
<p>åˆ™é€Ÿåº¦ä¸ºCNT&#x2F;(11*30)&#x2F;t&#x3D;å•ä½æ—¶é—´è½¬å‡ åœˆ</p>
<p><strong>è„‰å†²æ§åˆ¶ç”µæœºé€Ÿåº¦</strong>,ç¼–ç å™¨è¯»æ•°</p>
<p>é€šè¿‡ä¸€ç§’å‡ ä¸ªè„‰å†²,ç„¶åå»¶æ—¶</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/hbsyaaa/article/details/113784920">ç¼–ç å™¨è®¡æ•°åŸç†ä¸ç”µæœºæµ‹é€ŸåŸç†</a></p>

      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/2024/03/12/97-stm32-dan-pian-ji-de-exti-wai-bu-zhong-duan/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>Prev</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime mr-10" title="Update time"></i>
              2025-05-14 15:23:31
            </span>
            
          </div>
          <div class="post-foot-prev">
            
              <a href="/2024/03/17/99-tai-shan-pai-xue-xi-bi-ji-1/" target="_self">
                <span>Next</span>
                <i class="iconfont icon-chevronright"></i>
              </a>
            
          </div>
        </div>
      
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="title">Contents</div>
    <div class="catalog-content">
      
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%AE%9A%E6%97%B6%E5%99%A8%E6%A1%86%E5%9B%BE"><span class="toc-text">åŸºæœ¬å®šæ—¶å™¨æ¡†å›¾</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#STM32%E6%97%B6%E9%92%9F%E6%A0%91"><span class="toc-text">STM32æ—¶é’Ÿæ ‘</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E6%97%B6%E4%B8%AD%E6%96%AD%E6%A8%A1%E5%BC%8F"><span class="toc-text">å®šæ—¶ä¸­æ–­æ¨¡å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TIM1-RepetitionCounter"><span class="toc-text">TIM1_RepetitionCounter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RCR%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-text">RCRçš„å·¥ä½œåŸç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TIM-ClearFlag"><span class="toc-text">TIM_ ClearFlag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ARR%E4%B8%8EPSC"><span class="toc-text">ARRä¸PSC</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD%E6%A8%A1%E5%BC%8F"><span class="toc-text">å¤–éƒ¨ä¸­æ–­æ¨¡å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BE%93%E5%87%BA%E6%AF%94%E8%BE%83%E6%A8%A1%E5%BC%8F"><span class="toc-text">è¾“å‡ºæ¯”è¾ƒæ¨¡å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BC%E5%90%B8%E7%81%AF"><span class="toc-text">å‘¼å¸ç¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%88%B5%E6%9C%BA%E6%8E%A7%E5%88%B6"><span class="toc-text">èˆµæœºæ§åˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A9%B1%E5%8A%A8%E7%94%B5%E6%9C%BA"><span class="toc-text">é©±åŠ¨ç”µæœº</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9EPID%E6%8E%A7%E5%88%B6%E7%94%B5%E6%9C%BA%E4%BD%8D%E7%BD%AE"><span class="toc-text">éPIDæ§åˆ¶ç”µæœºä½ç½®</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BE%93%E5%85%A5%E6%8D%95%E8%8E%B7%E6%A8%A1%E5%BC%8F"><span class="toc-text">è¾“å…¥æ•è·æ¨¡å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%93%E9%94%99"><span class="toc-text">æ˜“é”™</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-text">ç¼–ç å™¨æ¨¡å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E5%99%A8%E6%B5%8B%E9%80%9F"><span class="toc-text">ç¼–ç å™¨æµ‹é€Ÿ</span></a></li></ol></li></ol>
      
    </div>
  </div>

  
<script src="/js/catalog.js"></script>




    
      <div class="comments-container">
        







      </div>
    
  </div>


        
<div class="footer">
  <div class="social">
    <ul>
      
        <li>
          
              <a title="github" target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">
                <i class="iconfont icon-github"></i>
              </a>
              
        </li>
        
    </ul>
  </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Copyright Â© 2025 Oranges</a>
        
    </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
  
</div>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



        
  <div class="search-icon tools-bar-item" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="Search...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>First search, index file loading, please wait...<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>No result<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The search.xml file was not found, please refer toï¼š<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The request failed, Try to refresh the page or try again later.<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="/js/colorscheme.js"></script>





        
  
    <div class="share-icon tools-bar-item">
      <a href="javascript: void(0)" id="share-icon">
        <i class="iconfont iconshare"></i>
      </a>
      <div class="share-content hidden">
        
          <a class="share-item" href="https://twitter.com/intent/tweet?text=' + STM32%E5%8D%95%E7%89%87%E6%9C%BA%E7%9A%84%E5%AE%9A%E6%97%B6%E5%99%A8 + '&url=' + http%3A%2F%2Fblog.isgeek.top%2F2024%2F03%2F16%2F98-stm32-dan-pian-ji-de-ding-shi-qi%2F + '" target="_blank" title="Twitter">
            <i class="iconfont icon-twitter"></i>
          </a>
        
        
          <a class="share-item" href="https://www.facebook.com/sharer.php?u=http://blog.isgeek.top/2024/03/16/98-stm32-dan-pian-ji-de-ding-shi-qi/" target="_blank" title="Facebook">
            <i class="iconfont icon-facebooksquare"></i>
          </a>
        
      </div>
    </div>
  
  
<script src="/js/shares.js"></script>



      </div>
    </div>
  </body>
</html>
